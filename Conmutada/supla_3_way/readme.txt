Supla 3 Way Switch works as a direct replacement for the last switch in a 3-way circuit.
Allows control from the App, existing switches and the button connected to the device (toggle).
status memory in case of power failure.

AC line detector
https://learn.edwinrobotics.com/230v110v-ac-mains-detection-using-arduino-raspberry-pi-and-esp8266-thing/

Sensor Gpio 5 -- D1
Relay  Gpio 4 -- D2
Button Gpio 0 -- D3
stsLed Gpio 2 -- D4
